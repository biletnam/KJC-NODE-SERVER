{"version":3,"sources":["../../commonModule/loginUtil.js"],"names":["jwt","require","secret","getToken","userData","p","Promise","resolve","reject","isDIrector","IS_USER","sign","_id","USER_ID","username","USER_NAME","_c_id","CUST_ID","isUser","isDirector","expiresIn","issuer","err","token","getTokenForNonUser","nonUserData","phone","PHONE","tokenCheckPromise","req","headers","query","verify","app","get","decoded","module","exports"],"mappings":";;AAAA,IAAMA,MAAMC,QAAQ,cAAR,CAAZ;AACA,IAAMC,SAASD,QAAQ,4BAAR,EAAsCC,MAArD;;AAEA,IAAMC,WAAW,SAAXA,QAAW,CAACC,QAAD,EAAc;AAC3B,QAAMC,IAAI,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvC,YAAMC,aAAaL,SAASM,OAAT,KAAqB,GAArB,GAA2B,IAA3B,GAAiC,KAApD;AACAV,YAAIW,IAAJ,CAAS;AACLC,iBAAKR,SAASS,OADT;AAELC,sBAAUV,SAASW,SAFd;AAGLC,mBAAOZ,SAASa,OAHX;AAILC,oBAAQ,IAJH;AAKLC,wBAAYV;AALP,SAAT,EAMGP,MANH,EAMW;AACPkB,uBAAW,IADJ;AAEPC,oBAAQ;AAFD,SANX,EASG,UAACC,GAAD,EAAMC,KAAN,EAAgB;AACf,gBAAGD,GAAH,EAAQd,OAAOc,GAAP;AACRf,oBAAQgB,KAAR;AACH,SAZD;AAaH,KAfS,CAAV;AAgBA,WAAOlB,CAAP;AACH,CAlBD;AAmBA,IAAMmB,qBAAqB,SAArBA,kBAAqB,CAACC,WAAD,EAAiB;AACxC,QAAMpB,IAAI,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvCR,YAAIW,IAAJ,CAAS;AACLG,sBAAUW,YAAYV,SADjB;AAELW,mBAAOD,YAAYE,KAFd;AAGLX,mBAAOS,YAAYR,OAHd;AAILC,oBAAQ;AAJH,SAAT,EAKGhB,MALH,EAKW;AACPkB,uBAAW,IADJ;AAEPC,oBAAQ;AAFD,SALX,EAQG,UAACC,GAAD,EAAMC,KAAN,EAAgB;AACf,gBAAID,GAAJ,EAASd,OAAOc,GAAP;AACTf,oBAAQgB,KAAR;AACH,SAXD;AAYH,KAbS,CAAV;AAcA,WAAOlB,CAAP;AACH,CAhBD;AAiBA,IAAMuB,oBAAoB,SAApBA,iBAAoB,CAACC,GAAD,EAAS;AAC/B,QAAMN,QAAQM,IAAIC,OAAJ,CAAY,gBAAZ,KAAiCD,IAAIE,KAAJ,CAAUR,KAAzD;;AAEA;AACA,QAAMlB,IAAI,IAAIC,OAAJ,CACN,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACjB,YAAG,CAACe,KAAJ,EAAW;AACPf,mBAAO,KAAP;AACH;AACDR,YAAIgC,MAAJ,CAAWT,KAAX,EAAkBM,IAAII,GAAJ,CAAQC,GAAR,CAAY,YAAZ,CAAlB,EAA6C,UAACZ,GAAD,EAAMa,OAAN,EAAkB;AAC3D,gBAAGb,GAAH,EAAQd,OAAOc,GAAP;AACRf,oBAAQ4B,OAAR;AACH,SAHD;AAIH,KATK,CAAV;AAWA;AACA,WAAO9B,CAAP;AACH,CAjBD;AAkBA+B,OAAOC,OAAP,GAAiB;AACblC,sBADa;AAEbyB,wCAFa;AAGbJ;AAHa,CAAjB","file":"loginUtil.js","sourcesContent":["const jwt = require('jsonwebtoken');\r\nconst secret = require('../config/oracle-db-config').secret;\r\n\r\nconst getToken = (userData) => {\r\n    const p = new Promise((resolve, reject) => {\r\n        const isDIrector = userData.IS_USER === 'D' ? true: false;\r\n        jwt.sign({\r\n            _id: userData.USER_ID,\r\n            username: userData.USER_NAME,\r\n            _c_id: userData.CUST_ID,\r\n            isUser: true,\r\n            isDirector: isDIrector\r\n        }, secret, {\r\n            expiresIn: '7d',\r\n            issuer: 'localhost'\r\n        }, (err, token) => {\r\n            if(err) reject(err);\r\n            resolve(token);\r\n        })\r\n    })\r\n    return p;\r\n}\r\nconst getTokenForNonUser = (nonUserData) => {\r\n    const p = new Promise((resolve, reject) => {\r\n        jwt.sign({\r\n            username: nonUserData.USER_NAME,\r\n            phone: nonUserData.PHONE,\r\n            _c_id: nonUserData.CUST_ID,\r\n            isUser: false\r\n        }, secret, {\r\n            expiresIn: '7d',\r\n            issuer: 'localhost'\r\n        }, (err, token) => {\r\n            if (err) reject(err);\r\n            resolve(token);\r\n        })\r\n    });\r\n    return p;\r\n}\r\nconst tokenCheckPromise = (req) => {\r\n    const token = req.headers['x-access-token'] || req.query.token\r\n\r\n    // create a promise that decodes the token\r\n    const p = new Promise(\r\n        (resolve, reject) => {\r\n            if(!token) {\r\n                reject(false);\r\n            }\r\n            jwt.verify(token, req.app.get('jwt-secret'), (err, decoded) => {\r\n                if(err) reject(err);\r\n                resolve(decoded)\r\n            })\r\n        }\r\n    )\r\n    // process the promise\r\n    return p;\r\n}\r\nmodule.exports = {\r\n    getToken,\r\n    tokenCheckPromise,\r\n    getTokenForNonUser\r\n}"]}