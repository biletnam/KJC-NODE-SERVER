{"version":3,"sources":["../../rest_controller/payMethod.js"],"names":["express","require","router","Router","Joi","payMethodService","commonUtil","loginUtil","post","req","res","validatePayClassify","body","error","status","send","details","message","tokenCheckPromise","then","decoded","isDirector","name","insertPayClassify","data","catch","validatePayDetail","detailObject","PAY_DETAIL_CODE_NAME","PAY_CL_CODE","payClassifyCode","PAY_MODULE_NAME","moduleName","insertPayDetail","errpr","get","findMethod","payMethodWrapper","classify","scheme","string","min","required","validate","detail","number","rows","PAY_METHOD_COLUMN","object","map","p","push","PAY_DET_CODE","PAY_DET_CODE_NAME","exceptObject","Object","keys","key","getExceptKeyObject","module","exports"],"mappings":"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","file":"payMethod.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Joi = require('joi');\r\nconst payMethodService = require('./oraclDBService/payMethodService');\r\nconst commonUtil = require('../commonModule/commonUtil');\r\nconst loginUtil = require('../commonModule/loginUtil');\r\nrouter.post('/classify', (req, res) => {\r\n    const {error} = validatePayClassify(req.body);\r\n    if(error) {\r\n        res.status(400).send(error.details[0].message);\r\n        return;\r\n    }\r\n    loginUtil.tokenCheckPromise(req)\r\n        .then((decoded) => {\r\n            const isDirector = decoded.isDirector;\r\n            if(!isDirector) {\r\n                res.status(403).send('no Director');\r\n                return;\r\n            }\r\n            const name = req.body.name;\r\n            payMethodService.insertPayClassify(name)\r\n                .then((data) => res.send(data))\r\n                .catch((error) => res.status(500).send(error));\r\n        }).catch((error) => res.status(403).send(error));\r\n\r\n});\r\nrouter.post('/detail', (req, res) => {\r\n    const {error} = validatePayDetail(req.body);\r\n    if(error) {\r\n        res.status(400).send(error.details[0].message);\r\n        return;\r\n    }\r\n    loginUtil.tokenCheckPromise(req)\r\n        .then((decoded) => {\r\n            const isDirector = decoded.isDirector;\r\n            if(!isDirector) {\r\n                res.status(403).send('no Director');\r\n                return;\r\n            }\r\n            const detailObject = {PAY_DETAIL_CODE_NAME: req.body.name, PAY_CL_CODE: req.body.payClassifyCode,\r\n                PAY_MODULE_NAME: req.body.moduleName};\r\n            payMethodService.insertPayDetail(detailObject)\r\n                .then((data) => res.send(data))\r\n                .catch((errpr) => res.status(500).send(error));\r\n        }).catch((error) => res.status(403).send(error));\r\n});\r\n\r\nrouter.get('/', (req,res) => {\r\n    payMethodService.findMethod()\r\n        .then((data) => res.send(payMethodWrapper(data)))\r\n        .catch((error) => res.status(500).send(error));\r\n})\r\n\r\nfunction validatePayClassify(classify) {\r\n    const scheme = {\r\n        name: Joi.string().min(1).required()\r\n    }\r\n    //\t\tminAge: Joi.number().required(),\r\n    return Joi.validate(classify,scheme);\r\n}\r\n\r\n\r\nfunction validatePayDetail(detail){\r\n    const scheme = {\r\n        name: Joi.string().min(1).required(),\r\n        moduleName: Joi.string().min(1).required(),\r\n        payClassifyCode: Joi.number().required()\r\n    }\r\n    //\t\tminAge: Joi.number().required(),\r\n    return Joi.validate(detail,scheme);\r\n}\r\n\r\nfunction payMethodWrapper(rows) {\r\n    const PAY_METHOD_COLUMN = ['PAY_DET_CODE', 'PAY_DET_CODE_NAME', 'PAY_MODULE_NAME'];\r\n    const object = {};\r\n    rows.map((p) => {\r\n        if(!object[p.PAY_CL_CODE]) {\r\n            object[p.PAY_CL_CODE] = p;\r\n        }\r\n        if(!object[p.PAY_CL_CODE]['PAY_DETAIL']) {\r\n            object[p.PAY_CL_CODE]['PAY_DETAIL'] = [];\r\n        }\r\n        if(p.PAY_CL_CODE) {\r\n            object[p.PAY_CL_CODE]['PAY_DETAIL'].push({\r\n                PAY_DET_CODE: p.PAY_DET_CODE,\r\n                PAY_DET_CODE_NAME: p.PAY_DET_CODE_NAME,\r\n                PAY_MODULE_NAME: p.PAY_MODULE_NAME,\r\n            });\r\n        }\r\n    })\r\n    const exceptObject = Object.keys(object).map((key) => {\r\n        return commonUtil.getExceptKeyObject(object[key], PAY_METHOD_COLUMN);\r\n    })\r\n    return exceptObject;\r\n}\r\nmodule.exports = router;"]}