{"version":3,"sources":["../../rest_controller/payMethod.js"],"names":["express","require","router","Router","Joi","payMethodService","commonUtil","post","req","res","validatePayClassify","body","error","status","send","details","message","name","insertPayClassify","then","data","catch","errpr","validatePayDetail","detailObject","PAY_DETAIL_CODE_NAME","PAY_CL_CODE","payClassifyCode","PAY_MODULE_NAME","moduleName","insertPayDetail","get","findMethod","payMethodWrapper","classify","scheme","string","min","required","validate","detail","number","rows","PAY_METHOD_COLUMN","object","map","p","push","PAY_DET_CODE","PAY_DET_CODE_NAME","exceptObject","Object","keys","key","getExceptKeyObject","module","exports"],"mappings":"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","file":"payMethod.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Joi = require('joi');\r\nconst payMethodService = require('./oraclDBService/payMethodService');\r\nconst commonUtil = require('../commonModule/commonUtil');\r\nrouter.post('/classify', (req, res) => {\r\n    const {error} = validatePayClassify(req.body);\r\n    if(error) {\r\n        res.status(400).send(error.details[0].message);\r\n        return;\r\n    }\r\n    const name = req.body.name;\r\n    payMethodService.insertPayClassify(name)\r\n        .then((data) => res.send(data))\r\n        .catch((errpr) => res.status(500).send(error));\r\n});\r\nrouter.post('/detail', (req, res) => {\r\n    const {error} = validatePayDetail(req.body);\r\n    if(error) {\r\n        res.status(400).send(error.details[0].message);\r\n        return;\r\n    }\r\n    const detailObject = {PAY_DETAIL_CODE_NAME: req.body.name, PAY_CL_CODE: req.body.payClassifyCode,\r\n        PAY_MODULE_NAME: req.body.moduleName};\r\n    payMethodService.insertPayDetail(detailObject)\r\n        .then((data) => res.send(data))\r\n        .catch((errpr) => res.status(500).send(error));\r\n});\r\n\r\nrouter.get('/', (req,res) => {\r\n    payMethodService.findMethod()\r\n        .then((data) => res.send(payMethodWrapper(data)))\r\n        .catch((error) => res.status(500).send(error));\r\n})\r\n\r\nfunction validatePayClassify(classify) {\r\n    const scheme = {\r\n        name: Joi.string().min(1).required()\r\n    }\r\n    //\t\tminAge: Joi.number().required(),\r\n    return Joi.validate(classify,scheme);\r\n}\r\n\r\n\r\nfunction validatePayDetail(detail){\r\n    const scheme = {\r\n        name: Joi.string().min(1).required(),\r\n        moduleName: Joi.string().min(1).required(),\r\n        payClassifyCode: Joi.number().required()\r\n    }\r\n    //\t\tminAge: Joi.number().required(),\r\n    return Joi.validate(detail,scheme);\r\n}\r\n\r\nfunction payMethodWrapper(rows) {\r\n    const PAY_METHOD_COLUMN = ['PAY_DET_CODE', 'PAY_DET_CODE_NAME', 'PAY_MODULE_NAME'];\r\n    const object = {};\r\n    rows.map((p) => {\r\n        if(!object[p.PAY_CL_CODE]) {\r\n            object[p.PAY_CL_CODE] = p;\r\n        }\r\n        if(!object[p.PAY_CL_CODE]['PAY_DETAIL']) {\r\n            object[p.PAY_CL_CODE]['PAY_DETAIL'] = [];\r\n        }\r\n        if(p.PAY_CL_CODE) {\r\n            object[p.PAY_CL_CODE]['PAY_DETAIL'].push({\r\n                PAY_DET_CODE: p.PAY_DET_CODE,\r\n                PAY_DET_CODE_NAME: p.PAY_DET_CODE_NAME,\r\n                PAY_MODULE_NAME: p.PAY_MODULE_NAME,\r\n            });\r\n        }\r\n    })\r\n    const exceptObject = Object.keys(object).map((key) => {\r\n        return commonUtil.getExceptKeyObject(object[key], PAY_METHOD_COLUMN);\r\n    })\r\n    return exceptObject;\r\n}\r\nmodule.exports = router;"]}