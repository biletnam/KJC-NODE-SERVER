{"version":3,"sources":["../../../rest_controller/oraclDBService/discountService.js"],"names":["dbConfig","require","oracledb","insertDiscount","discountObject","Promise","resolve","reject","getConnection","connectConfig","then","connection","sql","execute","DISC_NAME","DISC_METHOD","DISC_AMT","outFormat","OBJECT","autoCommit","err","result","console","log","doRelease","catch","error","findAll","rows","findByCode","Code","DISC_CODE","calculateDiscountPrice","price","method","amount","Math","floor","Number","close","module","exports"],"mappings":"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","file":"discountService.js","sourcesContent":["const dbConfig = require('../../config/oracle-db-config');\r\nconst oracledb = require('oracledb');\r\nfunction insertDiscount(discountObject){\r\n    return new Promise((resolve, reject) => {\r\n        oracledb.getConnection(dbConfig.connectConfig)\r\n            .then((connection) => {\r\n                const sql = `INSERT INTO DISCOUNT (DISC_CODE, DISC_NAME, DISC_METHOD, DISC_AMT)\r\n                VALUES(DISCOUNT_SEQ.NEXTVAL,:DISC_NAME, :DISC_METHOD, :DISC_AMT)`\r\n                connection.execute(sql,{DISC_NAME: discountObject.DISC_NAME, DISC_METHOD: discountObject.DISC_METHOD,\r\n                        DISC_AMT: discountObject.DISC_AMT},\r\n                    {outFormat: oracledb.OBJECT, autoCommit: true},\r\n                    (err, result) => {\r\n                        if(err) {\r\n                            console.log(err);\r\n                            doRelease(connection);\r\n                            reject(err);\r\n                            return;\r\n                        }\r\n                        doRelease(connection);\r\n                        resolve('success');\r\n                    })\r\n\r\n            })\r\n            .catch((error) => console.log(error));\r\n    })\r\n}\r\nfunction findAll() {\r\n    return new Promise((resolve, reject) => {\r\n        oracledb.getConnection(dbConfig.connectConfig)\r\n            .then((connection) => {\r\n                connection.execute('SELECT * FROM DISCOUNT', [], {outFormat: oracledb.OBJECT}, (err, result) => {\r\n                    if(err){\r\n                        console.log(err);\r\n                        doRelease(connection);\r\n                        reject('error');\r\n                        return;\r\n                    }\r\n                    doRelease(connection);\r\n                    resolve(result.rows);\r\n                })\r\n            }).catch((error) => {\r\n            console.log(error);\r\n        })\r\n    })\r\n}\r\nfunction findByCode(Code) {\r\n    return new Promise((resolve, reject) => {\r\n        oracledb.getConnection(dbConfig.connectConfig)\r\n            .then((connection) => {\r\n                connection.execute('SELECT * FROM DISCOUNT WHERE DISC_CODE = :DISC_CODE', {DISC_CODE: Code}, {outFormat: oracledb.OBJECT}, (err, result) => {\r\n                    if(err){\r\n                        console.log(err);\r\n                        doRelease(connection);\r\n                        reject('error');\r\n                        return;\r\n                    }\r\n                    doRelease(connection);\r\n                    resolve(result.rows);\r\n                })\r\n            }).catch((error) => {\r\n            console.log(error);\r\n        })\r\n    })\r\n}\r\n\r\nfunction calculateDiscountPrice(price, method, amount) {\r\n    console.log(price);\r\n    console.log(method);\r\n    console.log(amount);\r\n    if(method === '%'){\r\n        return Math.floor( Number(price) * Number(amount) / 100);\r\n    }else if(method === '-') {\r\n        return Number(amount);\r\n    }\r\n}\r\nfunction doRelease(connection) {\r\n    return connection.close((err) => {\r\n        if(err) {\r\n            console.log(err);\r\n        }\r\n    })\r\n}\r\n\r\nmodule.exports = {\r\n    insertDiscount,\r\n    findAll,\r\n    findByCode,\r\n    calculateDiscountPrice\r\n}"]}