{"version":3,"sources":["../../rest_controller/cinema.js"],"names":["express","require","router","Router","Joi","cinemaService","commonUtil","loginUtil","get","req","res","findAll","then","data","send","catch","error","console","log","status","post","validateCinema","body","details","message","tokenCheckPromise","decoded","isDirector","cinemaObject","CINEMA_NO","cinemaNumber","BRCH_ID","branch","SEAT_TYPE_ID","seatType","FLOOR","floor","rows","insertCinema","r","cinema","scheme","number","min","required","array","validate","module","exports"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;AACA,IAAMC,MAAMH,QAAQ,KAAR,CAAZ;AACA,IAAMI,gBAAgBJ,QAAQ,gCAAR,CAAtB;AACA,IAAMK,aAAaL,QAAQ,4BAAR,CAAnB;AACA,IAAMM,YAAYN,QAAQ,2BAAR,CAAlB;AACAC,OAAOM,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAKC,GAAL,EAAa;AACzBL,kBAAcM,OAAd,GACKC,IADL,CACU,UAACC,IAAD,EAAU;AACZH,YAAII,IAAJ,CAASD,IAAT;AACH,KAHL,EAIKE,KAJL,CAIW,UAACC,KAAD,EAAW;AAACC,gBAAQC,GAAR,CAAYF,KAAZ,EAAoBN,IAAIS,MAAJ,CAAW,GAAX,EAAgBL,IAAhB,CAAqB,WAArB;AAAmC,KAJ9E;AAKH,CAND;AAOAZ,OAAOkB,IAAP,CAAY,GAAZ,EAAiB,UAACX,GAAD,EAAKC,GAAL,EAAa;AAAA,0BACVW,eAAeZ,IAAIa,IAAnB,CADU;AAAA,QACnBN,KADmB,mBACnBA,KADmB;;AAE1B,QAAGA,KAAH,EAAU;AACNN,YAAIS,MAAJ,CAAW,GAAX,EAAgBL,IAAhB,CAAqBE,MAAMO,OAAN,CAAc,CAAd,EAAiBC,OAAtC;AACA;AACH;AACDjB,cAAUkB,iBAAV,CAA4BhB,GAA5B,EACKG,IADL,CACU,UAACc,OAAD,EAAa;AACf,YAAMC,aAAaD,QAAQC,UAA3B;AACA,YAAG,CAACA,UAAJ,EAAgB;AACZjB,gBAAIS,MAAJ,CAAW,GAAX,EAAgBL,IAAhB,CAAqB,aAArB;AACA;AACH;AACD,YAAMc,eAAe;AACjBC,uBAAWpB,IAAIa,IAAJ,CAASQ,YADH;AAEjBC,qBAAStB,IAAIa,IAAJ,CAASU,MAFD;AAGjBC,0BAAcxB,IAAIa,IAAJ,CAASY,QAHN;AAIjBC,mBAAO1B,IAAIa,IAAJ,CAASc,KAJC;AAKjBC,kBAAM5B,IAAIa,IAAJ,CAASe;AALE,SAArB;AAOAhC,sBAAciC,YAAd,CAA2BV,YAA3B,EACKhB,IADL,CACU,UAAC2B,CAAD;AAAA,mBAAO7B,IAAII,IAAJ,CAAS,SAAT,CAAP;AAAA,SADV,EAEKC,KAFL,CAEW,UAACC,KAAD;AAAA,mBAAWN,IAAIS,MAAJ,CAAW,GAAX,EAAgBL,IAAhB,CAAqBE,KAArB,CAAX;AAAA,SAFX;AAGH,KAjBL,EAiBOD,KAjBP,CAiBa,UAACC,KAAD;AAAA,eAAWN,IAAIS,MAAJ,CAAW,GAAX,EAAgBL,IAAhB,CAAqBE,KAArB,CAAX;AAAA,KAjBb;AAkBH,CAxBD;;AA0BA,SAASK,cAAT,CAAwBmB,MAAxB,EAAgC;AAC5B,QAAMC,SAAS;AACXX,sBAAc1B,IAAIsC,MAAJ,GAAaC,GAAb,CAAiB,CAAjB,EAAoBC,QAApB,EADH;AAEXP,cAAMjC,IAAIyC,KAAJ,EAFK;AAGXb,gBAAQ5B,IAAIsC,MAAJ,GAAaE,QAAb,EAHG;AAIXR,eAAOhC,IAAIsC,MAAJ,GAAaE,QAAb,EAJI;AAKXV,kBAAU9B,IAAIsC,MAAJ,GAAaE,QAAb;AAEd;AAPe,KAAf,CAQA,OAAOxC,IAAI0C,QAAJ,CAAaN,MAAb,EAAoBC,MAApB,CAAP;AACH;;AAEDM,OAAOC,OAAP,GAAiB9C,MAAjB","file":"cinema.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Joi = require('joi');\r\nconst cinemaService = require('./oraclDBService/cinemaService');\r\nconst commonUtil = require('../commonModule/commonUtil');\r\nconst loginUtil = require('../commonModule/loginUtil');\r\nrouter.get('/', (req,res) => {\r\n    cinemaService.findAll()\r\n        .then((data) => {\r\n            res.send(data);\r\n        })\r\n        .catch((error) => {console.log(error); res.status(404).send('not found');});\r\n})\r\nrouter.post('/', (req,res) => {\r\n    const {error} = validateCinema(req.body);\r\n    if(error) {\r\n        res.status(400).send(error.details[0].message);\r\n        return;\r\n    }\r\n    loginUtil.tokenCheckPromise(req)\r\n        .then((decoded) => {\r\n            const isDirector = decoded.isDirector;\r\n            if(!isDirector) {\r\n                res.status(403).send('no Director');\r\n                return;\r\n            }\r\n            const cinemaObject = {\r\n                CINEMA_NO: req.body.cinemaNumber,\r\n                BRCH_ID: req.body.branch,\r\n                SEAT_TYPE_ID: req.body.seatType,\r\n                FLOOR: req.body.floor,\r\n                rows: req.body.rows\r\n            }\r\n            cinemaService.insertCinema(cinemaObject)\r\n                .then((r) => res.send('success'))\r\n                .catch((error) => res.status(500).send(error));\r\n        }).catch((error) => res.status(403).send(error))\r\n});\r\n\r\nfunction validateCinema(cinema) {\r\n    const scheme = {\r\n        cinemaNumber: Joi.number().min(0).required(),\r\n        rows: Joi.array(),\r\n        branch: Joi.number().required(),\r\n        floor: Joi.number().required(),\r\n        seatType: Joi.number().required()\r\n    }\r\n    //\t\tminAge: Joi.number().required(),\r\n    return Joi.validate(cinema,scheme);\r\n}\r\n\r\nmodule.exports = router;"]}