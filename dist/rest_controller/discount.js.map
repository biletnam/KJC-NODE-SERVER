{"version":3,"sources":["../../rest_controller/discount.js"],"names":["express","require","router","Router","Joi","discountService","loginUtil","get","req","res","findAll","then","data","send","catch","error","status","post","validateDiscount","body","details","message","tokenCheckPromise","decoded","isDirector","discountObject","DISC_NAME","name","DISC_METHOD","discountMethod","DISC_AMT","discountAmount","insertDiscount","discount","scheme","string","min","required","number","validate","module","exports"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;AACA,IAAMC,MAAMH,QAAQ,KAAR,CAAZ;AACA,IAAMI,kBAAkBJ,QAAQ,kCAAR,CAAxB;AACA,IAAMK,YAAYL,QAAQ,2BAAR,CAAlB;AACAC,OAAOK,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAKC,GAAL,EAAa;AACzBJ,oBAAgBK,OAAhB,GACKC,IADL,CACU,UAACC,IAAD;AAAA,eAAUH,IAAII,IAAJ,CAASD,IAAT,CAAV;AAAA,KADV,EAEKE,KAFL,CAEW,UAACC,KAAD;AAAA,eAAWN,IAAIO,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqBE,KAArB,CAAX;AAAA,KAFX;AAGH,CAJD;AAKAb,OAAOe,IAAP,CAAY,GAAZ,EAAiB,UAACT,GAAD,EAAKC,GAAL,EAAa;AAAA,4BACVS,iBAAiBV,IAAIW,IAArB,CADU;AAAA,QACnBJ,KADmB,qBACnBA,KADmB;;AAE1B,QAAGA,KAAH,EAAU;AACNN,YAAIO,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqBE,MAAMK,OAAN,CAAc,CAAd,EAAiBC,OAAtC;AACA;AACH;AACDf,cAAUgB,iBAAV,CAA4Bd,GAA5B,EACKG,IADL,CACU,UAACY,OAAD,EAAa;AACf,YAAMC,aAAaD,QAAQC,UAA3B;AACA,YAAG,CAACA,UAAJ,EAAgB;AACZf,gBAAIO,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,aAArB;AACA;AACH;AACD,YAAMY,iBAAiB,EAACC,WAAWlB,IAAIW,IAAJ,CAASQ,IAArB,EAA2BC,aAAapB,IAAIW,IAAJ,CAASU,cAAjD;AACnBC,sBAAUtB,IAAIW,IAAJ,CAASY,cADA,EAAvB;;AAGA1B,wBAAgB2B,cAAhB,CAA+BP,cAA/B,EACKd,IADL,CACU,UAACC,IAAD;AAAA,mBAAUH,IAAII,IAAJ,CAASD,IAAT,CAAV;AAAA,SADV,EAEKE,KAFL,CAEW,UAACC,KAAD;AAAA,mBAAWN,IAAIO,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqBE,KAArB,CAAX;AAAA,SAFX;AAGH,KAbL,EAaOD,KAbP,CAaa,UAACC,KAAD;AAAA,eAAWN,IAAIO,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqBE,KAArB,CAAX;AAAA,KAbb;AAeH,CArBD;;AAuBA,SAASG,gBAAT,CAA0Be,QAA1B,EAAoC;AAChC,QAAMC,SAAS;AACXP,cAAMvB,IAAI+B,MAAJ,GAAaC,GAAb,CAAiB,CAAjB,EAAoBC,QAApB,EADK;AAEXR,wBAAgBzB,IAAI+B,MAAJ,GAAaE,QAAb,EAFL;AAGXN,wBAAgB3B,IAAIkC,MAAJ,GAAaD,QAAb;AAHL,KAAf;AAKA,WAAOjC,IAAImC,QAAJ,CAAaN,QAAb,EAAsBC,MAAtB,CAAP;AACH;;AAEDM,OAAOC,OAAP,GAAiBvC,MAAjB","file":"discount.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Joi = require('joi');\r\nconst discountService = require('./oraclDBService/discountService');\r\nconst loginUtil = require('../commonModule/loginUtil');\r\nrouter.get('/', (req,res) => {\r\n    discountService.findAll()\r\n        .then((data) => res.send(data))\r\n        .catch((error) => res.status(500).send(error));\r\n})\r\nrouter.post('/', (req,res) => {\r\n    const {error} = validateDiscount(req.body);\r\n    if(error) {\r\n        res.status(400).send(error.details[0].message);\r\n        return;\r\n    }\r\n    loginUtil.tokenCheckPromise(req)\r\n        .then((decoded) => {\r\n            const isDirector = decoded.isDirector;\r\n            if(!isDirector) {\r\n                res.status(403).send('no Director');\r\n                return;\r\n            }\r\n            const discountObject = {DISC_NAME: req.body.name, DISC_METHOD: req.body.discountMethod,\r\n                DISC_AMT: req.body.discountAmount};\r\n\r\n            discountService.insertDiscount(discountObject)\r\n                .then((data) => res.send(data))\r\n                .catch((error) => res.status(500).send(error));\r\n        }).catch((error) => res.status(403).send(error))\r\n\r\n})\r\n\r\nfunction validateDiscount(discount) {\r\n    const scheme = {\r\n        name: Joi.string().min(1).required(),\r\n        discountMethod: Joi.string().required(),\r\n        discountAmount: Joi.number().required()\r\n    }\r\n    return Joi.validate(discount,scheme);\r\n}\r\n\r\nmodule.exports = router;"]}